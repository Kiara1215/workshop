[TOC]

# 操作系统引论

**操作系统是配置在计算机硬件上的第一层软件，是对硬件系统的首次扩充，其主要作用是管理好这些设备，提高它们的利用率和系统的吞吐量，并为用户和应用程序提供一个简单的接口，便于用户使用。**



## 1.1 操作系统的目标和作用

### 1.1.1 操作系统的目标

1. 方便性
2. 有效性
   * **提高系统资源的利用率**；
   * **提高系统的吞吐量**；
3. 可扩充性
   * 可扩充性的好坏与OS的结构密切相关
   * OS结构的发展：无结构 —— 模块化结构 —— 层次化结构 —— 微内核结构
4. 开放性



### 1.1.2 操作系统的作用

1. 用户与计算机硬件系统之间的接口
   * 用户通过OS使用计算机；
2. 计算机系统资源的管理者
   * 计算机中的四类资源：处理机、存储器、I/O设备、文件；
3. 实现了对计算机资源的抽象
   * I/O设备管理软件：对计算机硬件操作的第一个层次的抽象；
   * 文件管理软件：对计算机硬件操作的第二个层次的抽象；
   * “虚机器”：覆盖了上述软件的机器；
   * **操作系统是铺设在计算机硬件上的多层软件的集合。它们增强了系统的功能、隐藏了对硬件操作的具体细节、实现了对计算机硬件操作的多个层次的抽象模型**；



### 1.1.3 推动操作系统发展的主要动力

1. 不断提高计算机资源利用率
2. 方便用户
3. 硬件的不断更新换代
4. 计算机体系结构的不断发展
5. 不断提出新的应用需求



## 1.2 操作系统的发展过程

### 1.2.1 未配置操作系统的计算机系统

1. 人工操作方式
   * 用户独占全机；
   * CPU等待人工操作；
2. 脱机输入/输出(Off-Line I/O)方式
   * **程序和数据的输入输出都是在外围机控制下完成的(脱离主机)**；
   * 减少了CPU的空闲时间；
   * 提高了I/O速度；



### 1.2.2 单道批处理系统(Simple Batch Processing System)

1. 处理过程
   * 监督程序(monitor, 管程)：由管程控制作业的运行，当一个作业处理完毕时，加载下一个作业；
   * 虽然对作业的处理是成批进行的，但内存中始终只保持一道作业，故称为单道批处理系统；
2. 缺点
   * 系统中的资源得不到充分利用；
     * CPU利用率低：每当作业中的程序发出I/O请求时，CPU都处于等待状态，又因I/O设备的低速性，CPU利用率显著降低；
     * 内存、I/O设备利用率低；



### 1.2.3 多道批处理系统(Multiprogrammed Batch Processing System)

1. 多道程序设计的基本概念
   * 所有作业存放在外存上，并排成一个队列，称为“后备队列”；
   * 由管程调用若干个作业，放入内存，使它们共享CPU和操作系统的各种资源；
   * 在运行作业A时，利用其I/O操作时CPU的空闲时间，运行作业B，**保持CPU处于忙碌状态**；
2. 多道批处理系统的目的：
   * **提高资源利用率和系统吞吐量**；
3. 多道批处理系统的优缺点
   * 优点：
     * 资源利用率高；
     * 系统吞吐量大；
   * 缺点：
     * 平均周转时间长；
     * 无交互能力；
4. 多道批处理系统需要解决的问题
   * 处理机争用；
   * 内存的分配和保护；
   * I/O设备分配；
   * 文件的组织和管理；
   * 作业管理；
   * 用户与系统的接口；

**操作系统是一组能有效地组织和管理计算机的硬件和软件资源，合理地对各类作业进行调度，以及方便用户使用的程序的集合。**



### 1.2.4 分时系统(Time Sharing System)

1. 分时系统的引入：
   * 目的：**人机交互， 共享主机**；(方便用户)
   * 定义：分时系统指在一台主机上连接有多个终端的系统，允许多用户同时通过自己的终端以交互的方式使用计算机，共享主机资源；
2. 分时系统实现中的关键问题：
   * 及时接受：
     * 多路卡：实现分时多路复用(主机以很快的速度周期性地扫描各个终端，在每个终端停留很短的时间，用于接收从终端发来的数据)；
     * 缓冲区：用来暂存用户输入的命令；
   * 及时处理：
     * 作业直接进入内存；
     * 采用轮转运行方式；
       * **时间片：很短的一段时间**
       * 系统规定每个作业只能运行一个时间片，然后就暂停该作业的运行，并立即调度下一个作业运行
       * 在不长的时间内使所有的作业都执行一个时间片的时间，使每个用户都能及时地与自己的作业进行交互；
3. 分时系统的特征：
   * 多路性：多个终端同时连接到同一台主机上；
   * 独立性：每个用户彼此间互不干扰；
   * 及时性：用户的请求能在很短的时间内得到响应；
   * 交互性：随时的人机对话；



### 1.2.5 实时系统(Real Time System)

1. 定义
   * **系统的正确性，不仅由计算的逻辑结果来确定，而且还取决于产生结果的时间**；
   * 实时系统指系统能及时响应外部事件的请求，在规定时间内完成对该事件的处理，并控制所有实时任务协调一致地运行；
2. 类型
   * 工业(武器)控制系统；
   * 信息查询系统；
   * 多媒体系统；
   * 嵌入式系统；
3. 实时任务的类型
   * 周期性实时任务 & 非周期性实时任务；
   * 硬实时任务(Hard Real-time Task, HRT) & 软实时任务(Soft Real-time Task, SRT)；
4. 实时系统与分时系统的比较
   * 多路性：相同；
   * 独立性：相同；
   * 及时性：实时系统更强；
   * 交互性：分时系统更强；
   * 可靠性：实时系统更强；(采用多级容错措施)



### 1.2.6 微机操作系统的发展

1. 单用户单任务操作系统
   * CP/M
   * MS-DOS(Disk Operating System)
2. 单用户多任务操作系统
   * Windows
3. 多用户多任务操作系统
   * UNIX OS
     * Solaris OS
     * Linux OS



## 1.3 操作系统的基本特性

### 1.3.1 并发(Concurrence)

1. 并发(Concurrence)和并行(Parallel)：
   * **并发：多个事件在同一时间间隔内发生，某个时刻只有一个事件发生，是宏观上同时发生**；
   * **并行：多个事件在同一时刻发生，某个时刻多个事件同时发生，是微观上同时发生**；
2. 引入进程：
   * 目的：提高系统资源的利用率，增加系统的吞吐量；
   * **进程：在系统中能独立运行并作为资源分配的基本单位，由一组机器指令、数据和堆栈等组成，是一个能独立运行的活动实体；(多进程之间能并发执行和交换信息)**



### 1.3.2 共享(Sharing)

1. 定义和特点：
   * 定义：指系统中的资源可供内存中多个并发执行的进程共同使用；
   * 特点：系统中的资源远少于多道程序需求的总和，会形成它们对共享资源的争夺；
2. 方式：
   * 互斥共享：
     * 互斥共享的资源称为临界资源(如打印机)，在同一时间只允许一个进程访问，需要用同步机制来实现对临界资源的访问；
   * 同时共享：
     * 在一段时间内，允许多个进程“同时”访问(如磁盘)；



### 1.3.3 虚拟(Virtual)

1. 目的：将一个物理实体转换为多个逻辑实体；
2. 两种虚拟技术：
   * 时分复用技术(**利用处理机的空闲时间运行其他进程，提高处理机的利用率**)：
     * 虚拟处理机技术：多个进程能在同一处理器上并发执行使用了时分复用技术，让每个进程轮流占有处理器，每次只执行一个时间片并快速轮转；
     * 虚拟设备技术：将一台物理设备虚拟为逻辑上的多台设备；
   * 空分复用技术(**利用存储器的空闲空间分区域存放和运行其他进程，提高内存的利用率**)：
     * 虚拟内存技术：
         * 要实现在逻辑上扩大存储器容量，必须引入**虚拟存储技术**(其实质是实现内存的时分复用)，使得一道程序能在远小于它需要的内存空间中运行；
         * 虚拟内存使用了空分复用技术，它将物理内存抽象为地址空间，每个进程都有各自的地址空间。地址空间的页被映射到物理内存，地址空间的页并不需要全部在物理内存中，当使用到一个没有在物理内存的页时，执行页面置换算法，将该页置换到内存中；



### 1.3.4 异步(Asynchronism)

1. 含义：由于资源等因素的限制，使得进程不能一次性执行完毕，而是走走停停，以不可知的速度向前推进；



## 1.4 操作系统的主要功能

### 1.4.1 处理机管理

**处理机的分配和运行都是以进程为基本单位的，因而对处理机的管理可归结为对进程的管理。**

1. 进程控制：
   * 创建和撤销进程/控制进行运行过程中的状态；
2. 进程同步：
   * 进程互斥方式：诸进程在访问临界资源时；(加锁)
   * 进程同步方式：相互合作去完成共同任务的进程间，由同步机构对它们的执行次序加以协调；(信号量)
3. 进程通信：
   * 实现相互合作进程之间的信息交换；
4. 调度：
   * 作业调度：将作业调入内存，并为之建立进程；
   * 进程调度：将处理机分配给进程；
5. NOTE：
   * 进程同步 & 进程通信的区别：
       * 进程同步是目的，进程通信是手段；
       * 为了实现进程同步，需要进程通信；



### 1.4.2 存储器管理

**目的：为多道程序的运行提供良好的环境，提高存储器利用率，方便用户使用，并能从逻辑上扩充内存。**

1. 内存分配：
   * 目的：
     * 为每道程序分配内存空间；
     * 提高存储器的利用率，尽量减少不可用的内存碎片；
     * 允许正在运行的程序申请附加的内存空间，以适应程序和数据动态增长的需要；
   * 方式：
     * 静态分配：每个作业的内存空间在作业装入内存时确定，运行期间该不允许该作业再申请新的内存，也不允许作业在内存中“移动”；
     * 动态分配：允许作业在运行过程中继续申请新的附加内存空间，也允许作业在内存中“移动”；
2. 内存保护：
   * 目的：确保每道程序都只在自己的内存区中运行；
   * 方式：设置两个界限寄存器；
3. 地址映射：
   * 目的：将地址空间中的逻辑地址转换为内存空间中与之对应的物理地址；
   * 方式：在硬件支持下完成；
4. 内存扩充：
   * 目的：借助虚拟存储技术，从逻辑上扩充内存容量，让更多的用户程序能并发运行；



### 1.4.3 设备管理

**目的：完成用户进程的IO请求，提高CPU和IO设备的利用率。**

1. 缓冲管理：
   * 目的：在IO设备和CPU之间引入缓冲，可有效缓解IO设备和CPU速度不匹配的矛盾，提高CPU利用率，进而提高系统吞吐量；
   * 缓冲区机制：
     * 单缓冲；
     * 双缓冲；(能实现双向同时传递数据)
     * 缓冲池；(能供多个设备同时使用)
2. 设备分配：
3. 设备处理：
   * 设备处理程序又称设备驱动程序，用于实现CPU和设备控制器之间的通信；



### 1.4.4 文件管理

**目的：对用户文件和系统文件进行管理以方便用户使用，保证文件的安全性。**

1. 文件存储空间管理：
2. 目录管理：
3. 文件的读写管理和保护：



### 1.4.5 操作系统与用户之间的接口

1. 用户接口：
   * 联机用户接口；(CLI)
   * 脱机用户接口；(Script)
   * 图形用户接口；(GUI)
2. 程序接口：
   * 目的：为用户程序在执行中访问系统资源而设置，是用户程序取得操作系统服务的唯一途径；



### 1.4.6 现代操作系统新功能

1. 系统安全：
   * 认证技术
   * 密码技术
   * 访问控制技术
   * 反病毒技术
2. 网络的功能和服务：
   * 网络通信
   * 资源管理
   * 应用互操作
3. 支持多媒体：
   * 接纳控制功能
   * 实时调度
   * 多媒体文件的存储



## 1.5 OS结构设计

### 1.5.1 传统操作系统结构

1. 无结构OS：
2. 模块化结构OS：
   * 模块化程序设计技术的基本概念：参考结构化程序设计技术；
   * 模块的独立性：
     * 内聚性：指模块内部各部分间联系的紧密程度。内聚性越高，独立性越强；
     * 耦合度；指模块间相互联系和相互影响的程度。耦合度越低，独立性越强；
   * 模块接口法的优缺点：
     * 优点：
       * 提高OS设计的正确性、可理解性、可维护性；
       * 增强OS的可适应性；
       * 加速OS的开发过程；
     * 缺点：
       * 设计时，对模块接口的规定很难满足设计完成后对接口的实际需求；
       * 设计阶段，各个模块的设计没有一个确定的顺序；(无序模块法)
3. 分层式结构OS：
   * 分层式结构的基本概念：
     * 为了将“无序模块法”设计中的无序性变为有序性，引入了有序分层法；
     * 采用自底向上法，在目标系统$A_n$和裸机系统$A_0$之间铺设若干个层次的软件；
     * 自底向上分层设计的原则：每一步设计都建立在可靠的基础上；
   * 分层结构的优缺点：
     * 优点：
       * 易保证系统的正确性；
       * 易扩充和维护性；
     * 缺点：
       
       * 系统效率降低；
       
           (需要在每层之间都建立通信机制，会增加系统的通信开销)



### 1.5.2 客户/服务器模式(Client/Server Model)

1. 客户/服务器模式的组成：
   * 客户机：一个自主计算机；
   * 服务器：一台较大规模的机器；
   * 网络系统：
2. 客户/服务器之间的交换：
   * 客户发送请求消息
   * 服务器接收消息
   * 服务器回送消息
   * 客户机接收消息
3. 客户/服务器模式的优点：
   * 数据的分布处理和存储；
   * 便于集中管理；
   * 灵活性和可扩充性；
   * 易于改编应用软件；



### 1.5.3 面向对象程序设计(Object-Orientated Programming)

1. 面向对象技术的基本概念：
   * 对象；
   * 对象类；
   * 继承；
2. 面向对象技术的优点：
   * 通过“重用”提高产品质量和生产率；
   * 使系统具有更好的易修改性和易扩展性；
   * 更易于保证系统的正确性和可靠性；



### 1.5.4 微内核OS结构

1. 微内核操作系统的基本概念：
   * 足够小的内核：
     * **将操作系统最基本的部分放入微内核**；
   * 基于客户/服务器模式：
     * **把操作系统的绝大部分功能都放在微内核之外的一组服务器(进程)中实现**；
     * **客户与服务器之间借助微内核提供的消息传递机制来实现信息交互**；
   * 应用“**机制与策略分离**”原理：
     * 机制：指实现某一功能的具体执行机构；(放在微内核中)
     * 策略：在机制的基础上借助某些参数和算法来实现该功能的优化；(放在微内核外)
     * **传统OS将机制放在内核的较低层，把策略放在内核的较高层；**
     * **微内核OS将机制放在微内核中，将策略放在微内核外**；
   * 采用面向对象技术：
2. 微内核的基本功能
   * 进程(线程)管理：
     * 调度
     * 通信
     * 切换
     * 同步
   * 低级存储器管理：
     * 地址映射：将逻辑地址转换为物理地址；(虚拟存储器管理放在微内核外)
   * 中断和陷入处理：
     * 进行中断现场保护；
     * 识别中断和陷入的类型；
3. 微内核操作系统的优点：
   * 提高了系统的可扩展性；
   * 增强了系统的可靠性；
   * 可移植性强；
   * 提供了对分布式系统的支持；
   * 融入了面向对象技术；
4. 微内核操作系统存在的问题：
  
   * 效率降低；
   
       (在完成一次客户对操作系统提出的服务请求时，需要利用消息实现多次交互和进行用户/内核模式与上下文的多次切换)