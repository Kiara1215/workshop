[TOC]



# 第6章 应用层



## 6.1 域名系统DNS

### 6.1.1 概述

1. 定义：
    * 域名系统DNS(Domain Name System)是互联网使用的命名系统；
    * 用来把便于人们使用的名字转化为便于机器使用的IP地址；
2. 作用：从域名解析出IP地址；
3. 数据传送方式：UDP用户数据报；
4. 查询过程：(递归查询 & 迭代查询)
    * 递归查询(recursive query)：主机向本地域名服务器的查询一般都采用递归查询。如果主机所询问的本地域名服务器不知道被查询域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其他根域名服务器继续发出查询请求报文(即替该主机继续查询，而不是让该主机自己进行下一步的查询)。因此，递归查询返回的结果要么是所要查询的IP地址，要么是报错(表示无法查询到所需的IP地址)；
    * 迭代查询(iterative query)：本地域名服务器向根域名服务器的查询一般采用迭代查询。当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地域名服务器，下一步应该向哪一个域名服务器进行查询，然后让本地域名服务器进行后续的查询(而不是替本地域名服务器进行后续查询)；
5. 特点：

    * DNS使用UDP连接，端口号为53；

    * DNS采用分布式系统；
        * 即使部分出现故障，也不影响整体；
        * 效率高；(大多数名字都在本地解析，仅少量解析需要在互联网通信)
    * DNS采用层次树状结构的命名方法；
        * 级别最低的域名写在最左边，级别最高的域名写在最右边；
        * 各级域名由其上一级的域名管理机构管理，而最高的顶级域名由ICANN管理；
6. Note：

    * 域名只是一个逻辑概念，并不代表计算机所在的物理地点；



### 6.1.2 域名结构

1. 原先的顶级域名TLD(Top Level Domain)分为三大类：
    * 国家顶级域名nTLD：cn(中国), us(美国), uk(英国)；
    * 通用顶级域名gTLD：com(公司企业), net(网络服务机构), org(非营利性组织), int(国际组织), ……
    * 基础结构域名(infrastructure domain)：arpa(反向域名，用于反向域名解析)
2. Note：
    * 互联网的名字空间是按照机构的组织来划分的，与物理网络无关，与IP地址中的"子网"也没关系；



### 6.1.3 域名服务器

1. 概述：DNS服务器管理以"区"为单位，而不是以"域"为单位；("区"是"域"的子集)
2. 分类：(根据域名服务器所起的作用)
    * 根域名服务器(root name server)：
        * 当本地服务器无法给出一个域名的解析时，首先求助于根域名服务器；
    * 顶级域名服务器(nTLD服务器)：
        * 当收到DNS查询时，就给出相应的回答；
    * 权限域名服务器：
        * 负责一个区的域名服务器；
        * 当一个权限域名服务器不能给出最后的查询回答时，会告诉发出查询请求的DNS客户，下一步应该找哪个权限域名服务器；
    * 本地域名服务器(local name server)：
        * 当一台主机发出DNS查询请求时，该请求首先发送给本地域名服务器；
        * 当所要查询的主机也属于同一个本地ISP时，直接得到结果，不需要询问其他域名服务器；
3. 域名解析过程：
    * 过程：
        * 首先，主机向本地域名服务器发送DNS查询请求；
        * 若本地域名服务器无法解析，则向根域名服务器寻求帮助；
    * 分类：
        * 递归查询：(主机向本地域名服务器的查询)
            * (参考书P.259 图6-5b)
            * 特点：当前域名服务器以DNS客户的身份向其他域名服务器继续发送查询请求报文；
        * 迭代查询：(本地域名服务器向根域名服务器的查询)
            * (参考书P.259 图6-5a)
            * 特点：当前域名服务器告诉本地域名服务器下一步向谁查询，本地域名服务器再发送查询请求报文给相应的域名服务器进行查询；



### 6.1.4 高速缓存域名服务器

1. 目的：为了提高DNS查询效率，在域名服务器中广泛使用高速缓存；

2. Note：

    * 高速缓存用来存放最近查询过的域名以及从何处获得域名映射信息的记录；

    * 域名服务器应为每项内容设置计时器并处理超过合理时间的项；

        (增加此时间值可以减少网络开销，减少此时间值可以提高域名转换的准确性)

    * 主机中也需要设置高速缓存；



## 6.2 文件传输协议FTP

### 6.2.1 文件共享协议

1. 分类：
    * 复制整个文件：
        * 特点：若要存取或修改一个文件，首先需要获得该文件的副本(即复制整个文件)；
        * 分类：基于TCP的FTP & 基于UDP的TFTP；
    * 联机访问：
        * 特点：允许多个程序同时对一个文件进行存取；
        * 分类：网络文件系统NFS(Network File System)；



### 6.2.2 文件传送协议FTP

1. 目的：FTP(File Transfer Protocol)将文件从一台计算机中复制到另一台计算机中；
2. 功能：减少或消除在不同操作系统下处理文件的不兼容性；
3. 特点：
    * 使用TCP连接，端口号为20(数据连接)/21(控制连接)；
    * 提供交互式的访问；
    * 使用客户服务器方式；
    * 允许用户指明文件的类型与格式，允许文件具有存取权限；
    * 屏蔽了不同计算机系统的细节，能够在异构网络的任意计算机之间传送信息；
4. 原理：
    * 两个连接：
        - 控制连接(对应控制进程)：服务器打开端口号21等待客户端的连接，客户端主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答；
        - 数据连接(对应数据传送进程)：用来传送一个文件数据；
    * 两种模式：
        * 主动模式：服务器端主动建立数据连接，其中服务器端的端口号为20，客户端的端口号随机，但是必须大于1024，因为0~1023是熟知端口号；
        * 被动模式：客户端主动建立数据连接，其中客户端的端口号由客户端自己指定，服务器端的端口号随机；
    * 传送过程：
        * 建立控制连接；
        * 建立数据连接；
        * 进行数据传送；
    * Note：
        * FTP使用了两个不同的端口号，分别对应控制连接(21)和数据连接(20)；



### 6.2.3 简单文件传送协议TFTP

1. 目的：TFTP(Trivial File Transfer Protocol)将文件从一台计算机中复制到另一台计算机中；
2. 功能：减少或消除在不同操作系统下处理文件的不兼容性；
3. 特点：
    * 使用UDP连接，端口号为69
    * 只支持文件传输而不支持交互；
    * 使用客户服务器方式；
    * 开销小；



## 6.3 远程终端协议TELNET

1. 作用：

    * TELNET 用于登录到远程主机上，并且远程主机上的输出也会返回；

2. 特点：

    * 使用TCP连接，端口号为23；

    * TELNET传输过程对用户是透明的，因此TELNET又称为终端仿真协议；

    * TELNET使用客户服务器方式；(本地运行TELNET客户进程，远地运行TELNET服务器进程)

    * TELNET 可以适应许多计算机和操作系统的差异；(例如不同操作系统系统的换行符定义)

        (通过网络虚拟终端NVT(Network Virtual Terminal)来实现)



## 6.4 万维网WWW

### 6.4.1 概述

1. 有关万维网的基本概念：
    * 超文本(Hypetext)：指包含指向其他文档的链接的文本；
    * 超媒体(Hypermedia)：是超文本的扩充，不仅包含文本信息，还包含图像、声音、视频等；
    * 分布式 & 非分布式：
        * 分布式：信息分布在整个互联网上，每台主机上的文档都独立管理；(信息一致性差)
        * 非分布式：信息驻留在单个计算机中；(信息一致性好)
2. 万维网的特点：
    * 超媒体系统；
    * 分布式服务；
    * 以CS方式工作；
3. 万维网中几个重要问题：
    * 怎样标志分布在整个互联网上的万维网文档？
        * 统一资源定位符URL(Uniform Resource Locator)
    * 用什么样的协议来实现万维网上的各种链接？
        * 超文本传送协议HTTP(HyperText Transfer Protocol)
    * 页面制作的标准化问题？
        * 超文本标记语言HTML(HyperText Makeup Language)



### 6.4.2 统一资源定位符URL

1. 作用：用来标志万维网上的各种文档，并使每一个文档在整个互联网范围内具有唯一的标识符URL；

2. 特点：

    * 互联网上的所有资源，都有一个唯一确定的URL；
    * URL相当于一个文件名在网络范围的扩展；

3. 组成：

    ```
    <协议>://<主机>:<端口>/<路径>
    ```

    * 协议：指出使用什么协议来获取该万维网文档(如http, ftp)；
    * 主机：指出这个万维网文档在哪个主机上；(这里的主机指该主机在互联网上的域名)
    * 端口：使用的端口号；(通常可以省略，http默认为80)
    * 路径：此万维网文档的存放路径；(通常可以省略)



### 6.4.3 超文本传送协议HTTP

1. 作用：定义了浏览器(客户进程)怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器；

2. 工作过程：

    * 发送连接建立请求；
    * 建立TCP连接(三次握手)；
    * 浏览器发出请求(HTTP请求报文)；
    * 服务器返回响应(HTTP响应报文)；

3. 特点：

    * 使用TCP连接，端口号为80；
    * HTTP协议本身是无连接的；
    * HTTP协议是无状态的(stateless)；
    * 请求一个万维网文档所需的时间是该文档的传输时间(与文档大小有关)加上两倍往返时间RTT(一个RTT用于建立TCP连接，另一个RTT用于请求和接收万维网文档)；
    * TCP建立连接的三次握手中，第三个报文段中的数据，就是客户对万维网文档的请求报文；

4. HTTP报文结构：

    - 分类：

        - 请求报文：客户向服务器发送的请求；
        - 响应报文：服务器向客户发送的回答；

    - 组成：

        - 开始行：

            - 作用：用于区分请求报文和响应报文；

                (请求报文的开始行叫请求行；响应报文的开始行叫状态行)

            - 请求行：

                - 方法：(参考书P.272 表6-1)
                - 请求资源的URL：
                - HTTP的版本：

            - 状态行：

                - HTTP的版本：
                - 状态码：(参考书P.272)
                - 解释状态码的简单短语：

        - 首部行：用来说明浏览器、服务器或报文主体的一些信息；

        - 空行：用来分隔首部和主体；

        - 实体主体：在请求报文中一般不用这个字段，而在响应报文中也可能不使用；

    - 举例：

        - 请求报文：
        - 响应报文：

5. HTTP/1.0 & HTTP/1.1：

    * HTTP/1.0：
        * 缺点：每请求一个文档就要有两倍RTT的开销；
    * HTTP/1.1：
        * 改进：使用持续连接(persistent connection)，即服务器在发送响应后仍然在一段时间内保持这条连接，使同一个客户和该服务器可以继续使用这条TCP连接进行通信；
        * 持续连接的两种工作方式：
            * 非流水线方式：客户在收到前一个响应后才能发出下一个请求；(浪费服务器资源)
            * 流水线方式：客户在收到响应之前就能接着发送新的请求；(提高效率)

6. 代理服务器：

    * 定义：代理服务器(proxy server)是一种网络实体，又称为万维网高速缓存(Web cache)；
    * 作用：把最近的一些请求和响应暂存在本地磁盘中。当新的请求到达时，若代理服务器发现这个请求与暂时存放的请求相同，就返回暂存的响应，而不需要按照URL的地址再去互联网访问该资源；
    * Note：
        * 代理服务器可在用户端或服务端工作，也可在中间系统工作；
        * 代理服务器有时是作为服务器(接收浏览器的HTTP请求)，有时却作为客户(向互联网发送HTTP请求)；

7. 在服务器上存放用户信息：

    * 问题：HTTP是无状态的，但有时一些网站需要能够识别用户；
    * 方法：使用Cookie来跟踪用户；
    * 原理：
        * 服务器为某客户提供一个唯一的识别码，通过响应报文发送给客户；
        * 客户再次向服务器发送请求报文时，添加该识别码；
        * 服务器根据请求报文中的识别码就可以跟踪该用户；
    * Note：
        * Cookie只是一个小小的文本文件，不是计算机的可执行程序，所以不可能传播病毒；
        * Cookie涉及用户隐私的保护问题；
    
8. 一个完整的HTTP请求过程：

    * 域名解析；(DNS查询：递归、迭代)
        * 首先查询浏览器DNS缓存；
        * 然后查询操作系统DNS缓存；
        * 查询本地DNS服务器；
        * 查询根域名服务器；
    * 建立TCP连接；(TCP三次握手)
    * 浏览器发起HTTP请求；(GET，向服务器请求数据；POST，向服务器传送数据)
        * HTTP请求报文：
            * 请求行：请求方法、请求地址、HTTP协议版本
            * 请求头部：为请求报文添加一些附加信息；
            * 空行：表示请求头部结束，接下来为请求数据；
            * 请求数据：可选部分，比如GET请求就没有数据；
    * 服务器响应HTTP请求，浏览器得到HTML代码；
        * HTTP响应报文：
            * 状态行：HTTP协议版本、状态码、解释短语
                * 状态码：
                    * 1**：通知信息
                    * 2**：成功
                    * 3**：重定向
                    * 4**：客户端差错
                    * 5**：服务器差错
            * 响应头部：为响应报文添加一些附加信息；
            * 空行：
            * 响应数据：存放需要返回给客户端的数据信息；
    * 浏览器解析HTML代码，并进行渲染呈现给用户；



### 6.4.4 万维网的文档

1. 超文本标记语言HTML：

    - 特点：

        - HTML并不是应用层协议，只是一种排版语言；
        - HTML定义了许多用于排版的命令，称为标签(tag)；
        - HTML文档可以用任何一种编辑器创建和编辑；
        - 当HTML文档是以.html或.htm为后缀时，浏览器才进行解释；
        - 并非所有的浏览器都支持所有的HTML标签；
        - HTML允在网页中插入图像；
        - HTML还规定了链接的设置方法；

    - 举例：

        ```html
        <HTML>
            <HEAD>
                <TITLE>An example for HTML</TITLE>
            </HEAD>
            <BODY>
                <H1>
                    HTML is easy to learn.
                </H1>
                <P>
                    This is first paragraphy.
                </P>
                <P>
                    This is second paragraphy.
                </P>
            </BODY>
        </HTML>
        ```

2. 和浏览器相关的其他语言：

    * 种类：
        * 可扩展标记语言XML(eXtensible Makeup Language)：传输数据而非显示数据(HTML)；
        * 可扩展超文本标记语言XHTML(eXtensible HTML)：更严格的HTML标准；
        * 层叠样式表CSS(Cascading Style Sheets)：一种样表式语言，用于为HTML文档定义布局；
    * NOTE：
        * CSS与HTML的区别：HTML用于结构化内容，而CSS用于格式化结构化的内容；

3. 万维网文档的分类：

    * 静态文档(static document)：
        * 定义：在创作完毕后存放在服务器中，在用户浏览过程中，其内容不会改变；
    * 动态文档(dynamic document)：
        * 定义：文档的内容在浏览器访问服务器时才由应用程序动态创建；
        * 实现：
            * 增加一个应用程序：用来处理浏览器发送来的数据，并创建动态文档；
            * 增加一个机制：使服务器将发送来的数据传送给该应用程序，并服务器能解释这个应用程序的输出，向浏览器返回HTML文档；
        * 通用网关接口CGI(Common Gateway Interface)：
            * 定义：CGI是一种标准，它定义了动态文档应该如何创建，输入数据应如何提供给应用程序，以及输出结果应该如何使用；
    * 活动文档(active document)：
        * 需求：浏览器屏幕显示的连续更新；
        * 两种技术：
            * 服务器推送(server push)：
                * 特点：将所有的工作都交给服务器；
                * 原理：服务器不断地运行与动态文档相关联的应用程序，定期更新信息，并发送更新过的文档；
                * 缺点：过多的服务器开销；网络传输时延增大；
            * 活动文档(active document)：
                * 特点：将所有的工作都交给浏览器；
                * 原理：Java applet；
                * 优点：克服了服务器推送的缺点；



### 6.4.5 万维网的信息检索系统

1. 搜索引擎分类：

    * 全文检索搜索引擎：google, bing, baidu；
    * 分类目录搜索引擎：yahoo, sina, sohu, 163；

2. Note：

    * 不管使用哪种搜索引擎，就是告诉你只要链接到什么地方就可以检索到所需要的信息；

        (搜索引擎网站本身并没有直接存储这些信息)



## 6.5 电子邮件协议

### 6.5.1 概述

1. 电子邮件系统的三个组成部分：
    * 用户代理UA(User Agent)：又称电子邮件客户端软件；
    * 邮件服务器：必须不间断地运行(因此个人主机不适合做邮件服务器)；
    * 邮件协议：
        * 发送协议：
            * 简单邮件传送协议SMTP(Simple Mail Transfer Protocol)
            * 通用互联网邮件扩充MIME(Multipurpose Internet Mail Extensions)
        * 接收协议：
            * 邮局协议POP3(Post Office Protocol 3)
            * 网际报文存取协议IMAP(Internet Message Access Protocol)
2. 电子邮件传送过程：(参考书P.285 图6-17)
    * 发送方UA
        * SMTP
    * 发送发邮件服务器
        * SMTP
    * 接收方邮件服务器
        * POP3
    * 接收方UA
3. 电子邮件传送过程说明：
    * 邮件服务器需要使用两种不同的协议：
        * SMTP：用户代理向邮件服务器发送邮件 or 邮件服务器之间发送邮件；
        * POP3：用户代理从邮件服务器读取邮件；
    * 邮件服务器必须能够同时充当客户和服务器；
    * SMTP和POP3都是使用TCP来连接来传送邮件的；
4. 电子邮件格式：
    * 信封(envelope)：地址(用户名@邮件服务器的域名)；
    * 内容(content)：
        * 首部(header)：
            * To
            * Subject
            * Cc(Carbon copy)
            * Bcc(Blind carbon copy)
            * From
            * Date
            * Reply-to
        * 主体(body)：



### 6.5.2 发送协议

1. 简单邮件传送协议SMTP：

    * SMTP特点：
        * SMTP使用TCP连接，端口号为25；
        * SMTP不使用中间的邮件服务器，直接由发送方邮件服务器传送到接收方的邮件服务器；
        * SMTP只能发送ASCII码，而不能传送二进制数据；

    * SMTP通信的三个阶段：
        * 连接建立：
        * 邮件传送：
            * MAIL：
                * 从发送方UA到发送方邮件服务器；
            * RCPT(recipient，收件人)：
                * 从发送方邮件服务器到接收方邮件服务器；
                * 检查接收方邮件服务器是否准备好，避免资源浪费；
            * DATA：
                * 从发送方邮件服务器到接收方邮件服务器；
                * 传送邮件内容；
        * 连接释放：
            * QUIT：

2. 通用互联网邮件扩充MIME：

    * MIME特点：(参考书P.292 图6-18)
        * MIME可以发送二进制文件；
        * MIME没有改动或者取代SMTP；
        * MIME增加了邮件主体的结构，定义了非ASCII码的编码规则；



### 6.5.3 接收协议

1. 邮局协议POP3：
    * POP3特点：(简单但功能有限)
        * 使用TCP连接，端口号为110；
        * 只要用户从服务器上读取了邮件，就把服务器上的该邮件删除；
2. 网际报文存取协议IMAP：(Internet Mail Access Protocol)
    * IMAP特点：
        * 使用TCP连接，端口号为143；
        * 客户端和服务器上的邮件保持同步，如果不手动删除邮件，那么服务器上的邮件也不会被删除；
        * IMAP这种做法可以让用户随时随地去访问服务器上的邮件；



## 6.6 动态主机配置协议DHCP

1. DHCP(Dynamic Host Configuration Protocol)特点：
    * DHCP提供了即插即用的连网方式，用户不再需要去手动配置IP地址等信息；
    * DHCP配置的内容不仅是IP地址，还包括子网掩码、网关IP地址。
2. DHCP工作过程：(参考书P.296)
    * 客户端发送Discover报文，该报文的目的地址为255.255.255.255:67，源地址为0.0.0.0:68，被放入UDP中，该报文被广播到同一个子网的所有主机上。如果客户端和DHCP服务器不在同一个子网，就需要使用中继代理；
    * DHCP服务器收到Discover报文之后，发送Offer报文给客户端，该报文包含了客户端所需要的信息。因为客户端可能收到多个DHCP服务器提供的信息，因此客户端需要进行选择；
    * 如果客户端选择了某个DHCP服务器提供的信息，那么就发送Request报文给该DHCP服务器；
    * DHCP服务器发送Ack报文，表示客户端此时可以使用提供给它的信息；



## 6.7 简单网络管理协议SNMP

1. SNMP(Simple Network Management Protocol)基本原理：
    * 若要管理某个对象，就必然会给该对象添加一些硬件或软件，但这种"添加"对原有对象的影响必须尽量小
2. SNMP的三个组成部分：(参考书P.299)
    *  简单网络管理协议SNMP(Simple Network Management Protocol)：
        * 负责读取和改变各代理中的对象名及状态数值；
    * 管理信息结构SMI(Structure of Management Information)：
        * 定义命名对象和定义对象类型(包括范围和长度)的通用规则；
        * 把对象和对象的值进行编码的基本编码规则BER()；
    * 管理信息库MIB(Management Information Base)：
        * 在被管理的实体中创建了命名对象，并规定其类型；



## 6.8 应用进程跨越网络的通信

1. 应用编程接口API(Application Programming Interface)：
    * 是应用进程的控制权和操作系统的控制权进行转换的一个接口；
    * 即应用进程和操作系统之间的接口，又称系统调用接口；
2. 套接字接口(socket interface)：
    * 是应用进程和运输层协议之间的接口；
    * 是应用进程为了获得网络通信服务而与操作系统进行交互时使用的一种机制；
    * (套接字接口是API的子集???)；



## 6.9 P2P应用

…..



## 6.10 Web页面请求过程

1. DHCP 配置主机信息：
    * 假设主机最开始没有 IP 地址以及其它信息，那么就需要先使用 DHCP 来获取。
    * 主机生成一个 DHCP 请求报文，并将这个报文放入具有目的端口 67 和源端口 68 的 UDP 报文段中。
    * 该报文段则被放入在一个具有广播 IP 目的地址(255.255.255.255) 和源 IP 地址（0.0.0.0）的 IP 数据报中。
    * 该数据报则被放置在 MAC 帧中，该帧具有目的地址 FF:FF:FF:FF:FF:FF，将广播到与交换机连接的所有设备。
    * 连接在交换机的 DHCP 服务器收到广播帧之后，不断地向上分解得到 IP 数据报、UDP 报文段、DHCP 请求报文，之后生成 DHCP ACK 报文，该报文包含以下信息：IP 地址、DNS 服务器的 IP 地址、默认网关路由器的 IP 地址和子网掩码。该报文被放入 UDP 报文段中，UDP 报文段有被放入 IP 数据报中，最后放入 MAC 帧中。
    * 该帧的目的地址是请求主机的 MAC 地址，因为交换机具有自学习能力，之前主机发送了广播帧之后就记录了 MAC 地址到其转发接口的交换表项，因此现在交换机就可以直接知道应该向哪个接口发送该帧。
    * 主机收到该帧后，不断分解得到 DHCP 报文。之后就配置它的 IP 地址、子网掩码和 DNS 服务器的 IP 地址，并在其 IP 转发表中安装默认网关。

2. ARP 解析 MAC 地址：
    * 主机通过浏览器生成一个 TCP 套接字，套接字向 HTTP 服务器发送 HTTP 请求。为了生成该套接字，主机需要知道网站的域名对应的 IP 地址。
    * 主机生成一个 DNS 查询报文，该报文具有 53 号端口，因为 DNS 服务器的端口号是 53。
    * 该 DNS 查询报文被放入目的地址为 DNS 服务器 IP 地址的 IP 数据报中。
    * 该 IP 数据报被放入一个以太网帧中，该帧将发送到网关路由器。
    * DHCP 过程只知道网关路由器的 IP 地址，为了获取网关路由器的 MAC 地址，需要使用 ARP 协议。
    * 主机生成一个包含目的地址为网关路由器 IP 地址的 ARP 查询报文，将该 ARP 查询报文放入一个具有广播目的地址（FF:FF:FF:FF:FF:FF）的以太网帧中，并向交换机发送该以太网帧，交换机将该帧转发给所有的连接设备，包括网关路由器。
    * 网关路由器接收到该帧后，不断向上分解得到 ARP 报文，发现其中的 IP 地址与其接口的 IP 地址匹配，因此就发送一个 ARP 回答报文，包含了它的 MAC 地址，发回给主机。

3. DNS 解析域名：
    * 知道了网关路由器的 MAC 地址之后，就可以继续 DNS 的解析过程了。
    * 网关路由器接收到包含 DNS 查询报文的以太网帧后，抽取出 IP 数据报，并根据转发表决定该 IP 数据报应该转发的路由器。
    * 因为路由器具有内部网关协议（RIP、OSPF）和外部网关协议（BGP）这两种路由选择协议，因此路由表中已经配置了网关路由器到达 DNS 服务器的路由表项。
    * 到达 DNS 服务器之后，DNS 服务器抽取出 DNS 查询报文，并在 DNS 数据库中查找待解析的域名。
    * 找到 DNS 记录之后，发送 DNS 回答报文，将该回答报文放入 UDP 报文段中，然后放入 IP 数据报中，通过路由器反向转发回网关路由器，并经过以太网交换机到达主机。

4. HTTP 请求页面：
    * 有了 HTTP 服务器的 IP 地址之后，主机就能够生成 TCP 套接字，该套接字将用于向 Web 服务器发送 HTTP GET 报文。
    * 在生成 TCP 套接字之前，必须先与 HTTP 服务器进行三次握手来建立连接。生成一个具有目的端口 80 的 TCP SYN 报文段，并向 HTTP 服务器发送该报文段。
    * HTTP 服务器收到该报文段之后，生成 TCP SYN ACK 报文段，发回给主机。
    * 连接建立之后，浏览器生成 HTTP GET 报文，并交付给 HTTP 服务器。
    * HTTP 服务器从 TCP 套接字读取 HTTP GET 报文，生成一个 HTTP 响应报文，将 Web 页面内容放入报文主体中，发回给主机。
    * 浏览器收到 HTTP 响应报文后，抽取出 Web 页面内容，之后进行渲染，显示 Web 页面。
